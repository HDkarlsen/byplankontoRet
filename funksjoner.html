<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>funksjoner</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="funksjoner_files/libs/clipboard/clipboard.min.js"></script>
<script src="funksjoner_files/libs/quarto-html/quarto.js"></script>
<script src="funksjoner_files/libs/quarto-html/popper.min.js"></script>
<script src="funksjoner_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="funksjoner_files/libs/quarto-html/anchor.min.js"></script>
<link href="funksjoner_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="funksjoner_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="funksjoner_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="funksjoner_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="funksjoner_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">



<section id="funksjoner" class="level1">
<h1>Funksjoner</h1>
<p>Det er først når du lærer deg å ta i bruk funksjoner skikkelig at mulighetene til R virkelig starter å utfolde seg. Her skal vi først se litt på hva en funksjon er, og deretter hvordan vi kan lage våre egne funksjoner.</p>
<p>Vi har faktisk allerede brukt masse funksjoner! Det meste i R er enten en funksjon eller et objekt. Eksempler på funksjoner vi har brukt er <code>sum()</code>, <code>data.frame()</code> og til og med <code>c()</code>. Funksjoner tar imot <em>argumenter</em>, og disse argumentene plasseres mellom de to parentesene. Dermed kan vi kjenne igjen en funksjon ved at den har parenteser etter navnet.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> <strong>Merk likevel at en funksjon ikke trenger å ta inn noen argumenter</strong>. Mange av import-funksjonene jeg har skrevet tar ingen argumenter, de bare returnerer objekter.</p>
<p>En viktig ting som funksjoner lar oss gjøre er å abstrahere oppgaver. Vi sparer tid ved å slippe å gjenta oss. Det er et uttrykk som sier at dersom du oppdager at du skriver det samme tre ganger bør du putte det i en funksjon. <code>tidyverse</code> gir oss mange funksjoner som er tidsbesparende, men <del>noen ganger</del> ofte kan vi gjøre ting lettere ved å lage egne funksjoner.</p>
<!-- gjerne et eksempel på det her -->
<p>En annen ting funksjoner lar oss gjøre er å skrive bedre koder. Dette kan dere se spesielt i prognoseevlaueringsskriptene mine. Jeg putter alt av koder inn i funksjoner som jeg putter i en skriptfil. Noen av funksjonene påkaller hverandre. Så har jeg et kort, lite <em>main</em>-skript som påkaller de viktigste funksjonene. Disse funksjonene har lett-forståelige navn slik at du skjønner hva de gjør. La oss kikke kort på den:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>prognose <span class="ot">&lt;-</span> <span class="fu">hent_prognose</span>(prognose_filsti)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>folkemengde <span class="ot">&lt;-</span> <span class="fu">hent_folkemengde</span>(folkemengde_filsti)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>folkemengde <span class="ot">&lt;-</span> folkemengde <span class="sc">%&gt;%</span> </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">vask_folkemengde</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summer_folkemengde</span>()</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>prognose <span class="ot">&lt;-</span> prognose <span class="sc">%&gt;%</span> </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">vask_prognose</span>()</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>sammenstilling <span class="ot">&lt;-</span> <span class="fu">lag_sammenstilling</span>(<span class="at">prog =</span> prognose, <span class="at">folk =</span> folkemengde) <span class="sc">%&gt;%</span> </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">vask_sammenstilling</span>()</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>sammenlikning <span class="ot">&lt;-</span> sammenstilling <span class="sc">%&gt;%</span> </span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lag_differanser</span>(TR2019)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Alle disse funksjonene har jeg skrevet sjøl, og når de står sammen slik får vi en historie:</p>
<blockquote class="blockquote">
<p>Hent to datasett Begge vaskes, folkemengde blir også summert La en sammenstilling, som består av begge datasetta. Vask sammenstilinga Lag differanseskårer</p>
</blockquote>
<p>Det er en kunst å lage bra funksjonsnavn og strukturer, og jeg skal ikke late som jeg er en kløpper i det sjøl.</p>
<section id="anatomien-til-en-funksjon" class="level2">
<h2 class="anchored" data-anchor-id="anatomien-til-en-funksjon">Anatomien til en funksjon</h2>
<p>Funksjonen har et <em>navn</em> og null eller flere <em>argumenter</em>, og den returnerer et <em>objekt.</em> Vi lager den ganske likt som et objekt, ved å assigne det en navn med <code>&lt;-</code>. Vi bruker funksjonen <code>function()</code> for å definere at dette er en funksjon. Og som argument til <code>function()</code> skriver vi navnet på eventuelle argumenter funksjonen vår skal ha. Så putter vi det som funksjonen skal gjøre inni sløyfeparenteser (<em>braces</em>)<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>min_funksjon <span class="ot">&lt;-</span> <span class="cf">function</span>(argument1) {</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Her skriver vi det funksjonen skal gjøre</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Slik påkaller vi funksjonen</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">min_funksjon</span>(et_argument)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># En enkel funksjon:</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Opphøyer et tall i to.</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>opphoy2 <span class="ot">&lt;-</span> <span class="cf">function</span>(num) {</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  num<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">opphoy2</span>(<span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">opphoy2</span>(<span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 36</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># En funksjon med to argumenter</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>summer_to <span class="ot">&lt;-</span> <span class="cf">function</span>(num1, num2) {</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  num1 <span class="sc">+</span> num2</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summer_to</span>(<span class="dv">4</span>, <span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># En funksjon med null argumenter</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>hvilken_tid_er_det <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="st">"Akkurat nå er tida:"</span>, <span class="fu">Sys.time</span>())</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">hvilken_tid_er_det</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Akkurat nå er tida: 2023-03-31 15:48:10"</code></pre>
</div>
</div>
</section>
<section id="avanserte-funksjonstips" class="level2">
<h2 class="anchored" data-anchor-id="avanserte-funksjonstips">Avanserte funksjonstips</h2>
<section id="default-verdier" class="level3">
<h3 class="anchored" data-anchor-id="default-verdier">Default-verdier</h3>
<p>Du kan gi default-verdier til en funksjon. Dette er nyttig der hvor du har en antakelse om hva funksjonen skal brukes til, men du vil ha fleksibilitet til å velge noe annet. Dette vil du se når du bruker andre funksjoner og det gjør at vi slipper å måtte definere alle argumentene i en funksjon. Vi setter en default-verdi slik:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sett et argument lik noe for å gi den en default-verdi</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>opphoy_i_x <span class="ot">&lt;-</span> <span class="cf">function</span>(num, <span class="at">x =</span> <span class="dv">2</span>) {</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  num<span class="sc">^</span>x</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="fu">opphoy_i_x</span>(<span class="dv">4</span>) <span class="co"># opphøyer 4 i 2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">opphoy_i_x</span>(<span class="dv">4</span>, <span class="dv">3</span>) <span class="co"># opphøyer 4 i 3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 64</code></pre>
</div>
</div>
</section>
<section id="dots-ellipse" class="level3">
<h3 class="anchored" data-anchor-id="dots-ellipse">Dots (ellipse)</h3>
<p>Vi kan bruke en ellipse (…) når vi vil la en funksjon ta inn et hvilket som helst antall argumenter. Dette er nyttig hvis vi ikke helt veit hvor mange ting vi skal sende til funksjonen. Vanligvis hvis vi skal behandle mange variabler. Hvis vi lager funksjoner som håndterer alle årsvariablene i en prognose vil dette i 2019 kunne være <code>2060 - 2019 =</code> 41 variabler, mens det i 2023 kan være <code>2050-2023 =</code> 27. Istedenfor å lage to funksjoner som tar imot ulikt antall variabler lager vi én funksjon som tar imot en ellipse:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>summer_disse <span class="ot">&lt;-</span> <span class="cf">function</span>(...) {</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="st">"Summen av alle disse er:"</span>,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sum</span>(...))</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summer_disse</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Summen av alle disse er: 10"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summer_disse</span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Summen av alle disse er: 60"</code></pre>
</div>
</div>
</section>
</section>
<section id="scope" class="level2">
<h2 class="anchored" data-anchor-id="scope">Scope</h2>
<p>For å parafrasere en kjent replikk:</p>
<blockquote class="blockquote">
<p>What happens in a function, stays in a function</p>
</blockquote>
<p>Vi har prata litt om miljøet (<em>environment</em>) tidligere. Når vi definerer objekter blir de liggende i miljøet vårt, som vi ser (vanligvis) i vinduet øverst til høyre i R-studio. <img src="img/environment.png" class="img-fluid" style="width:50.0%" alt="environment"></p>
<p>Når det havner her, kan vi henvise til det så mye vi vil, fra hvor som helst (i den samme sesjonen). Hvis vi restarter R-sesjonen vil alt i miljøet forsvinne, fram til vi definerer det igjen.</p>
<p>Funksjoner er annerledes. Det som defineres <em>inni</em> funksjonen vil ikke bli tilgjengelig for miljøet utafor funksjonen. La oss se et eksempel</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>foo <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>en_funksjon <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  bar <span class="ot">&lt;-</span> <span class="dv">3</span> </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  bar <span class="sc">*</span> <span class="dv">2</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>foo <span class="co"># Tilgjengelig</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">en_funksjon</span>() <span class="co"># Tilgjengelig</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>bar <span class="co"># Ikke tilgjengelig - fordi `bar` bare er definert inni funksjonen.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'bar' not found</code></pre>
</div>
</div>
<p>En måte å dra nytte av denne kunnskapen på, er at du kan holde midlertidige objekter inni funksjonen. Hvis vi ikke trenger den i miljøet vårt kan vi holde den unna, og holde det ryddigere.</p>
<p>Merk at motsatt vei går an: en funksjon veit hva som er i miljøet, siden funksjonen er en del av miljøet. Så vi kan henvise til objekter som ligger i miljøet fra inni en funksjon.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>foo <span class="ot">&lt;-</span> <span class="dv">2</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>en_funksjon <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  foo <span class="sc">*</span> <span class="dv">3</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="fu">en_funksjon</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6</code></pre>
</div>
</div>
</section>
<section id="inspirasjon-fra-tidyverse" class="level2">
<h2 class="anchored" data-anchor-id="inspirasjon-fra-tidyverse">Inspirasjon fra tidyverse</h2>
<p>Når jeg lager funksjoner tar jeg inspirasjon fra tidyverse og sørger for at det første argumentet som tas inn er et datasett. Dermed kan vi bruke pipa til å sende datasett fra funksjon til funksjon. Derfor får vi ofte funksjoner som ser slik ut:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>vask_datasett <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">dat =</span> folkemengde, multiplisering) {</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  dat <span class="sc">%&gt;%</span> </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">nytt_bra_navn =</span> dårlig_gammelt_navn) <span class="sc">%&gt;%</span> </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">kul_ny_variabel =</span> gammel_variabel <span class="sc">*</span> multiplisering) <span class="sc">%&gt;%</span> </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(nytt_bra_navn, kul_ny_variabel)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>La oss se litt nøyere på hva som skjer her. Funksjonen vi heter lager <code>vask_datasett()</code>. Den tar inn et argument <code>dat</code>, og et argument <code>multiplisering</code>. <code>dat</code> har jeg forhåndsdefinert, jeg antar at datasettet jeg vil sende til funksjonen heter folkemengde. Hvorfor gjør jeg dette? Hvis jeg veit hva datasettet heter, hvorfor lar jeg meg bruke et annet datasett istedenfor? Fordi jeg ofte ender opp med å bruke funksjonen på <em>flere</em> datasett. Med denne tilnærminga gjør jeg det lettere i framtida. Eller hvis datasettet en gang skifter navn fra <code>folkemengde</code> til <em>folkemengde-2023</em>, for eksempel. Legg merke til innholdet (<em>body</em>) til funksjonen. Det starter med at vi tar datasettet, generisk definert som <code>dat</code>, og sender videre via ei pipe (<code>%&gt;%</code>).</p>
<p>Funksjonen tar også inn et annet argument som jeg <em>ikke</em> har forhåndsdefinert, <code>multiplisering</code>. Dette argumentet må defineres. Jeg forventer at det er tall, for det brukes seinere til å multiplisere en gammel_variabel med.</p>
<p>Slik bruker vi funksjonen vår:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vask_datasett</span>(folkemengde, <span class="dv">3</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Eller, med pipe</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>folkemengde <span class="sc">%&gt;%</span> <span class="fu">vask_datasett</span>(<span class="dv">3</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Hvis vi skal bruke folkemengde som datasett, og siden det er forhåndsdefinert,</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># trenger vi strengt tatt ikke en gang å nevne det. Vi kan gjøre slik:</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="fu">vask_datasett</span>(<span class="dv">3</span>)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Men det er smart å være spesifikk i argumentene man sender, så jeg anbefaler</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co"># at du bruker en av de to første metodene. Det er lett å returnere til dette</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="co"># etter noen måneder og glemme at folkemengde er nevnt i funksjonen på det </span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="co"># siste eksemplet.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>La oss dykke dypere i dette, med fare for å være overtydelig. Hvordan ville en <em>dårligere</em> funksjon sett ut? Dårligere, fordi den er <em>mindre generisk</em>. Den ville sett slik ut:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>vask_datasett_daarlig <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  folkemengde <span class="sc">%&gt;%</span> </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">nytt_bra_navn =</span> dårlig_gammelt_navn) <span class="sc">%&gt;%</span> </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">kul_ny_variabel =</span> gammel_variabel <span class="sc">*</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(nytt_bra_navn, kul_ny_variabel)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Hovedforskjellen her er er at jeg har fjerna de to argumentene fra funksjonen. Dermed trenger vi ikke legge ved noen argumenter når vi kjører funksjonen. I funksjonens kropp henvises det nå direkte til <code>folkemengde</code>, ikke til noe generisk <code>dat</code>. Og vi multipliserer alltid med 2. Hvis vi vil multiplisere med noe annet må vi gå inn i funksjonen og skrive den om. Hvis vi vil vaske et annet datasett må vi gå inn og endre navnet på det i funksjonen. Det blir mer jobb for oss i framtida og <em>sannsynligheten for at vi gjør noe galt øker</em>. Kanskje ikke så mye, men alle monner drar.</p>
<p>Kanskje har vi ikke bruk for å endre multipliseringsfaktoren eller datasettnavnet <em>akkurat nå</em>. Men det koster oss lite å legge inn denne funksjonaliteten, og det vil potensielt spare oss arbeid i framtida.</p>
</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Man kan henvise til en funksjon uten å bruke parenteser når man ikke trenger å spesifisere noen av argumentene. For eksempel i dette tilfellet: <code>vektor1 %&gt;% sum</code>. Jeg anbefaler likevel at du er konsekvent og alltid har med parentesene. Dette er også anbefalt i <a href="https://style.tidyverse.org/functions.html">stilguiden</a> til <code>tidyverse</code>. Parentesene gjør det lettere å gjenkjenne funksjoner.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Jeg nevner det her, fordi det forvirra meg en stund: Sløyfeparentesene er faktisk ikke nødvendig. De gjør at du kan skrive innholdet i funksjonen <em>over flere linjer</em>. Og vi har nesten alltid funksjoner som går over flere linjer. Dermed vil du nesten alltid se funksjoner med disse parantesene. Om du derimot har en veldig kort funksjon trenger du ikke sløyfeparenteser, da skriver du det bare på samme linje. F.eks. denne korte funksjonen som multipliserer et tall med seg sjøl: <code>kort_funksjon &lt;- function(tall) tall * tall</code>. Når det er sagt, lær deg å assosiser sløyfeparenteser med funksjoner.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>