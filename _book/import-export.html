<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>R for Byplankontoret - 5&nbsp; Import og eksport av data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./inspisere.html" rel="next">
<link href="./grunnleggende.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Import og eksport av data</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">R for Byplankontoret</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Forord</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduksjon</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./omR.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Om R</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pakker.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Pakker</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./grunnleggende.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Det grunnleggende</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./import-export.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Import og eksport av data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./inspisere.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Inspisere data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pivot.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Omstrukturering av data (pivot)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./filter.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Velge rader</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./transformasjoner.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Tranformasjoner</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./feil.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Typiske feil vi (jeg) gj√∏r og hvordan fikse dem</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">Referanser</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#felles-m√∏nstre" id="toc-felles-m√∏nstre" class="nav-link active" data-scroll-target="#felles-m√∏nstre"><span class="toc-section-number">5.1</span>  Felles m√∏nstre</a>
  <ul class="collapse">
  <li><a href="#filnavn" id="toc-filnavn" class="nav-link" data-scroll-target="#filnavn"><span class="toc-section-number">5.1.1</span>  Filnavn</a></li>
  <li><a href="#relative-fillokasjoner" id="toc-relative-fillokasjoner" class="nav-link" data-scroll-target="#relative-fillokasjoner"><span class="toc-section-number">5.1.2</span>  Relative fillokasjoner</a></li>
  <li><a href="#skr√•streker-til-besv√¶r" id="toc-skr√•streker-til-besv√¶r" class="nav-link" data-scroll-target="#skr√•streker-til-besv√¶r"><span class="toc-section-number">5.1.3</span>  Skr√•streker til besv√¶r</a></li>
  <li><a href="#tegnkoding" id="toc-tegnkoding" class="nav-link" data-scroll-target="#tegnkoding"><span class="toc-section-number">5.1.4</span>  Tegnkoding</a></li>
  </ul></li>
  <li><a href="#tekstfiler-csv-med-familie" id="toc-tekstfiler-csv-med-familie" class="nav-link" data-scroll-target="#tekstfiler-csv-med-familie"><span class="toc-section-number">5.2</span>  Tekstfiler (csv med familie)</a></li>
  <li><a href="#spss" id="toc-spss" class="nav-link" data-scroll-target="#spss"><span class="toc-section-number">5.3</span>  SPSS</a></li>
  <li><a href="#excel" id="toc-excel" class="nav-link" data-scroll-target="#excel"><span class="toc-section-number">5.4</span>  Excel</a>
  <ul class="collapse">
  <li><a href="#skrive-til-excel-openxlsx" id="toc-skrive-til-excel-openxlsx" class="nav-link" data-scroll-target="#skrive-til-excel-openxlsx"><span class="toc-section-number">5.4.1</span>  Skrive til Excel: <code>openxlsx</code></a></li>
  <li><a href="#lese-excel-filer-readxl" id="toc-lese-excel-filer-readxl" class="nav-link" data-scroll-target="#lese-excel-filer-readxl"><span class="toc-section-number">5.4.2</span>  Lese Excel-filer: <code>readxl</code></a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Import og eksport av data</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>‚îÄ‚îÄ Attaching packages ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ tidyverse 1.3.2 ‚îÄ‚îÄ
‚úî ggplot2 3.3.6      ‚úî purrr   0.3.5 
‚úî tibble  3.1.8      ‚úî dplyr   1.0.10
‚úî tidyr   1.2.1      ‚úî stringr 1.4.1 
‚úî readr   2.1.3      ‚úî forcats 0.5.2 
‚îÄ‚îÄ Conflicts ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ tidyverse_conflicts() ‚îÄ‚îÄ
‚úñ dplyr::filter() masks stats::filter()
‚úñ dplyr::lag()    masks stats::lag()</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>here() starts at C:/Users/HK2Q/Documents/r/dokumentasjon</code></pre>
</div>
</div>
<p>Vi har en god del muligheter n√•r det kommer til √• laste inn data. Det er bra, for dataene v√•re finnes i mange formater:</p>
<ul>
<li><code>.csv</code>: et kommaseparert dokument. En tekstfil som vi kan lese med det blotte √∏ye. Rader atskilles med linjeskift, kolonner med komma. I Norge bruker vi komma som desimalseparator, hvilket forkludrer <code>.csv</code>-filer. Derfor har vi ofte <code>.tsv</code>-filer istedenfor. Disse er tab-separerte. Noen ganger f√•r de ogs√• forkortelsen <code>.csv</code>. Andre ganger bruker man semikolon istedenfor komma for √• separere en <code>.csv</code>-fil. En <code>.csv</code>-fil er et vakkert monument til en ydmyk minimalisme og n√∏kternhet, og burde hvis gudene var sanne hadde dette v√¶rt det eneste dataformatet vi hadde trengt √• bry oss om.</li>
<li><code>.xlsx</code>: Microsoft Office Excels filformat. Disse filene jobber doble skift med √• b√•de lagre data og ‚Äútransformasjonene‚Äù vi har gjort p√• det. De fungerer ut fra sin egen logikk. Dette gj√∏r det noe utfordrende for oss √• hente ut data fra dem. Hvor utfordrende det er kommer mye an p√• hvor konsekvent personen som har laga fila har v√¶rt. Her er vi ofre for en av Excels svakheter: den tillater deg √• gj√∏re dumme ting. Excel er ikke et standard filformat. Kildekoden er propriet√¶r og kan endres n√•r som helst. Vi burde dermed ikke gj√∏re det til en vane √• dele data i dette formatet. Likevel er det en kjensgjerning at mye data ligger lagra som Excel-filer, nettopp fordi Excel er mye brukt og det er lettvint.</li>
<li><code>.xls</code>: Microsoft Office Excels gamle filformat. Funker likt som Excels nye filformat bortsett fra n√•r det ikke gj√∏r det. Hvis bare det hadde fantes et mer universelt datalagringsformat som holdt seg konstant over tid og sted. Akk ja.</li>
<li><code>.sav</code>: SPSS‚Äô filformat.</li>
<li><code>.dta</code>: Statas filformat.</li>
</ul>
<p>La oss bli filosofiske et √∏yeblikk: hva er egentlig en datafil?</p>
<p>Det varierer ut fra hvilket filformat vi prater om. Hvis vi tenker oss om, vil et svar kunne dreie seg om f√∏lgende punkter: Vi er interessert i <strong>datapunkter</strong> lagra i celler. Vi kan identifisere cellene ut fra hvilken <strong>rad</strong> og <strong>kolonne</strong> de st√•r i. Det er fint √• f√• med <strong>variabelnavn/kolonnenavn</strong>.</p>
<p>Felles for mange av filformata p√• lista over er at de gj√∏r mye mer enn dette. Excel inneholder fargeformateringer p√• celler, funksjoner som regner ut innhold i celler, og djevelens verste verk: den sammensl√•tte cella. SPSS kan gi oss filer med b√•de en verdi og en merkelapp.</p>
<p>Den beskjedne <code>.csv</code>-fila gir oss kun det vi trenger og frister oss ikke ut i uf√∏re ved √• la oss bli mer avanserte enn dette. Den holder oss √¶rlig ved at vi ikke kan gj√∏re dumme ting som √∏delegger for oss seinere.</p>
<p>N√•r det er sagt, det er ikke alltid <code>.csv</code> strekker til. N√•r vi jobber med kart-data trenger vi geoinformasjon, og da m√• vi si farvel til fordel for <a href="https://r.geocompx.org/read-write.html#data-output">formater som</a> <code>.gpkg</code>.</p>
<hr>
<section id="felles-m√∏nstre" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="felles-m√∏nstre"><span class="header-section-number">5.1</span> Felles m√∏nstre</h2>
<p>Importering og eksportering henger sammen, s√• vi kan omtale dem samtidig. Det er st√∏rre forskjell p√• de ulike formatene vi h√•ndterer, s√• vi organiserer oss etter dem. Imidlertid er det noen grunnleggende m√∏nstre vi kan diskutere felles.</p>
<p>De fleste importeringsfunksjoner kalles noe med <em>read</em>, fordi de leser inn filer. Dermed blir eksporteringsfunksjoner <em>write</em>, fordi de skriver filer til disken.</p>
<section id="filnavn" class="level3" data-number="5.1.1">
<h3 data-number="5.1.1" class="anchored" data-anchor-id="filnavn"><span class="header-section-number">5.1.1</span> Filnavn</h3>
<p>Vi m√• ofte definere et navn p√• fila vi skal skrive eller lese. N√•r vi leser filer, vil navnet ofte bety b√•de</p>
<ol type="1">
<li>hva heter fila og</li>
<li>hvor ligger fila lagra</li>
</ol>
<p>Dette er fordi et filnavn strengt tatt inkludere hele <em>filstien</em> til fila. Den fila jeg arbeider p√• n√• heter f.eks. <code>import-export.qmd</code>. Den ligger p√• dette filomr√•det p√• datamaskina mi: <code>C:/Users/HK2Q/Documents/r/dokumentasjon</code>. Dermed blir det <em>egentlige</em> navnet p√• fila: <code>C:/Users/HK2Q/Documents/r/dokumentasjon/import-export.qmd</code>. Husk at ogs√• filtutvidelsen (det som kommer ettter <code>.</code>) er en del av filnavnet! N√•r en funksjon ber om <code>file</code> eller <code>path</code> betyr dette ofte at de vil ha hele det fulle filnavnet inkludert filsti.</p>
</section>
<section id="relative-fillokasjoner" class="level3" data-number="5.1.2">
<h3 data-number="5.1.2" class="anchored" data-anchor-id="relative-fillokasjoner"><span class="header-section-number">5.1.2</span> Relative fillokasjoner</h3>
<p>Man kan alltids henvise til konkrete omr√•der p√• maskina, men dette er optimalt fordi det gj√∏r at du aldri kan flytte noen filer igjen. Dessuten vil ikke koden funke p√• en annen persons PC med mindre de har 100 % likt oppsett p√• deres maskin. Derfor er det nyttig med <strong>relative</strong> filstier. N√•r du arbeider i Rstudio (og du er ikke en g√¶rning som arbeider i R GUI, er du vel?) forventes det at du arbeider i s√•kalte <strong>prosjekter</strong>. Alle mine prosjekter ligger kopiert p√• <code>M:</code>-disken. Et prosjekt er en mappe med visse filer i seg, hvorav den viktige fila er <code>prosjekt_navn.Rproj</code>. Denne opprettes automatisk n√•r du lager et prosjekt via Rstudio. Det er mange flotte ting med prosjekter, og en av dem er at alle filstier defineres ut fra prosjektets <strong>rotmappe</strong>. Rotmappa er den mappa hvor <code>.Rproj</code>-filer ligger, og der du putter alle mapper og filer assosiert med prosjektet. N√•r du arbeider i prosjekter trenger du ikke definere hele filstien til en fil, bare <em>hvor den ligger i forhold til rotmappa</em>. F.eks. har jeg for denne boka lagt alle bilder i en mappe som heter <code>img</code>. Hvis jeg vil henvise til et bilde skrive jeg bare <code>img/bilde.png</code>. Gj√∏r det til en vane √• bruke relative filstier n√•r du kan!</p>
<p>Det g√•r s√• klart ikke alltid. N√•r noe ligger p√• f.eks. <code>M:</code>-disken m√• jeg lage en full filsti. Fordelen er at <code>M:</code> er en delt disk, s√• jeg kan anta at filstien vil se likt ut for andre.</p>
<p>Merk at i noen tilfeller brytes antakelsen om at filstien alltid er relativt til rotmappa. I disse tilfellene er pakka <code>here</code> sv√¶rt nyttig. Den er ogs√• nyttig p√• grunn av noe annet, nemlig skr√•strekproblematikken</p>
<!-- gjerne mer kodeeksempler her -->
</section>
<section id="skr√•streker-til-besv√¶r" class="level3" data-number="5.1.3">
<h3 data-number="5.1.3" class="anchored" data-anchor-id="skr√•streker-til-besv√¶r"><span class="header-section-number">5.1.3</span> Skr√•streker til besv√¶r</h3>
<p>I Windows brukes denne skr√•streket <code>\</code> til √• indikere ei mappe. I alle UNIX-baserte operativsystemet og programmer brukes <code>/</code>. Eksempler p√• sistnevnte er Ubuntu, macOS, og R. N√•r vi arbeider med R p√• Windows skjer det dermed en del arbeid i kulissene n√•r vi henviser til en filplassering. Dette blir √•penbart for oss n√•r vi for eksempel fors√∏ker √• lime inn en filsti fra Windows explorer (filutforskeren). R godtar ikke uten videre ‚Äúfeil‚Äù skr√•strek. Det er to l√∏sninger p√• dette:</p>
<ol type="1">
<li>endre skr√•strekene s√• de g√•r andre vei</li>
<li><em>escape</em> skr√•strekene</li>
</ol>
<p>Det siste inneb√¶rer √• bruke det som kalles <em>escape characters</em>. En del tegn har meninger i koden. F.eks. betyr <code>#</code> kommentar i et R-skript. Hvis jeg vil skrive ut emneknaggen, m√• jeg legge p√• en escape character s√• R skj√∏nner at dette tegnet skal ikke skal tolkes slik det vanligvis tolkes. Hva er escape-tegnet? Det er nettopp <code>\</code>. For √• escape <code>#</code> skriver vi dermed <code>\#</code>, og for √• escape <code>\</code> skriver vi alts√• <code>\\</code>. <!-- sjekk at # ikke blir til noe annet og m√• escapes --></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ok</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="st">"C:/Users/HK2Q/Documents/r/dokumentasjon"</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Ikke ok</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="st">"C:\Users\HK2Q\Documents</span><span class="sc">\r</span><span class="st">\dokumentasjon"</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Ok</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="st">"C:</span><span class="sc">\\</span><span class="st">Users</span><span class="sc">\\</span><span class="st">HK2Q</span><span class="sc">\\</span><span class="st">Documents</span><span class="sc">\\</span><span class="st">r</span><span class="sc">\\</span><span class="st">dokumentasjon"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>En kjapp m√•te √• f√• skr√•strekene etter √• ha kopiert en filsti i Windows er f√∏lgende</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Skriver ut filsti med esaped `\` til konsollen. Funksjonen leser </span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># innholdet i utklippstavla og limer det inn i konsollen.</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(<span class="fu">readClipboard</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Alt dette for √• si: <code>here</code> pakka l√∏ser en del av problema v√•re. Les mer om den p√• <a href="https://github.com/jennybc/here_here">Ode to the here package</a>.</p>
</section>
<section id="tegnkoding" class="level3" data-number="5.1.4">
<h3 data-number="5.1.4" class="anchored" data-anchor-id="tegnkoding"><span class="header-section-number">5.1.4</span> Tegnkoding</h3>
<p>Spesielt n√•r det kommer til norske <code>.csv</code>-filer hender det vi f√•r et problem med tegnkodinga (<em>character encoding</em>). En full gjennomgang blir for omfattende. Det holder √• si at, igjen, dette er hovedsaklig et Windows-problem. Ideelt sett vil vi ha alt over i unicode (UTF-8). Noen filer er lagra i et annet format. Gjerne ISO8859-1 som er en av standardene som gir oss skandinaviske tegn. En forkludrende faktor er at det tidvis (og inntil ganske nylig, per 2023-03) har v√¶rt problemer med R og/eller Rstudio n√•r det kommer til tegnkoding. Disse blir fiksa med tida og er kanskje allerede fiksa. Du ser problemet dukke opp dersom du forventer √• se en √¶. √∏ eller √• i outputen og istedet f√•r noe s√•nt som <code>"\xe6\xf8\xe5"</code>, <code>√É¬¶√É¬∏√É¬•</code> eller <code>&lt;U+00C6&gt;</code>. Der er mange ulike faktorer som kan v√¶re √•rsak til dette problemet. En av dem kan v√¶re at du m√• sette tegnkoden spesifikt n√•r du leser en fil. I noen av eksemplene mine vil du set at jeg har spesifisert <em>encoding</em>, og da er det derfor.</p>
</section>
</section>
<section id="tekstfiler-csv-med-familie" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="tekstfiler-csv-med-familie"><span class="header-section-number">5.2</span> Tekstfiler (csv med familie)</h2>
<p>Vi kan bruke <code>read.csv()</code> fra <code>utils</code>, en av pakkene som lastes n√•r vi starter R. Det finnes ogs√• noen funksjoner fra <code>readr</code>, en del av, 100 poeng til den som gjetter rett, <code>tidyverse</code>. Herfra f√•r vi <code>read_csv()</code>, <code>read_csv2()</code>, <code>read_tsv()</code> og <code>read_delim()</code>. Les dokumentasjon for √• finne mer informasjon om dem. Kort fortalt er forskjellen at alle tre er implementeringer av den mer generelle <code>_delim()</code>. La oss skrive en fil og deretter last den inn.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Dette datasettet ligger klart n√•r vi laster inn R.</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>mtcars</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># La oss lagre det som en csv-fil</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(<span class="at">file =</span> <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"mtcars.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Og s√• laster vi den inn igjen</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>biler <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="at">file =</span> <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"mtcars.csv"</span>), <span class="at">name_repair =</span> <span class="st">"universal"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 32 Columns: 11
‚îÄ‚îÄ Column specification ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Delimiter: ","
dbl (11): mpg, cyl, disp, hp, drat, wt, qsec, vs, am, gear, carb

‚Ñπ Use `spec()` to retrieve the full column specification for this data.
‚Ñπ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>biler</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 32 √ó 11
     mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb
   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1  21       6  160    110  3.9   2.62  16.5     0     1     4     4
 2  21       6  160    110  3.9   2.88  17.0     0     1     4     4
 3  22.8     4  108     93  3.85  2.32  18.6     1     1     4     1
 4  21.4     6  258    110  3.08  3.22  19.4     1     0     3     1
 5  18.7     8  360    175  3.15  3.44  17.0     0     0     3     2
 6  18.1     6  225    105  2.76  3.46  20.2     1     0     3     1
 7  14.3     8  360    245  3.21  3.57  15.8     0     0     3     4
 8  24.4     4  147.    62  3.69  3.19  20       1     0     4     2
 9  22.8     4  141.    95  3.92  3.15  22.9     1     0     4     2
10  19.2     6  168.   123  3.92  3.44  18.3     1     0     4     4
# ‚Ä¶ with 22 more rows</code></pre>
</div>
</div>
<p>Jeg foretrekker <code>readr</code>s funksjoner fordi de har mange nyttige alternativer slik som <code>name_repair = "universal"</code>. Denne passer p√• at navna i datasettet er p√• et format som R tolererer. F.eks. at de ikke har mellomrom i seg. Veldig nyttig. Med <code>na =</code> kan du fortelle R hvordan missing er lagra i fila du importerer.</p>
</section>
<section id="spss" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="spss"><span class="header-section-number">5.3</span> SPSS</h2>
<p>For SPSS-filer bruker vi pakka <code>haven</code>. Denne pakka er en del av ‚Ä¶ ja, du skj√∏nner.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Lagrer en fil som en spss-fil. (Jeg lagrer bare de f√∏rste fire kolonnene).</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_sav</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"starwars.sav"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Les inn en spss-fil</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>stjernekrig <span class="ot">&lt;-</span> <span class="fu">read_sav</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"starwars.sav"</span>), <span class="at">.name_repair =</span> <span class="st">"universal"</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>stjernekrig <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 √ó 4
  name           height  mass hair_color   
  &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;        
1 Luke Skywalker    172    77 "blond"      
2 C-3PO             167    75 ""           
3 R2-D2              96    32 ""           
4 Darth Vader       202   136 "none"       
5 Leia Organa       150    49 "brown"      
6 Owen Lars         178   120 "brown, grey"</code></pre>
</div>
</div>
<p>Legger du merke til noe med fila over? Hva om jeg printer ut de tilsvarende kolonner fra det opprinnelige datasettet v√•rt?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 √ó 4
  name           height  mass hair_color 
  &lt;chr&gt;           &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      
1 Luke Skywalker    172    77 blond      
2 C-3PO             167    75 &lt;NA&gt;       
3 R2-D2              96    32 &lt;NA&gt;       
4 Darth Vader       202   136 none       
5 Leia Organa       150    49 brown      
6 Owen Lars         178   120 brown, grey</code></pre>
</div>
</div>
<p>H√•rfarge har mista <code>NA</code>-designasjonen. N√• er de som f√∏r var missing bare tomme. Dette kan skape hodebry for oss seinere, s√• det er bra vi oppdaga det n√•.</p>
<p>For √• v√¶re helt √¶rlig er jeg ikke sikker p√• hvordan man l√∏ser dette direkte. Feilen oppst√•r enten n√•r vi eksporterer til <code>.sav</code> eller importerer tilbake til R. Kanskje finnes det et svar i <a href="https://haven.tidyverse.org/articles/semantics.html#tagged-missing-values">Havens dokumentasjon</a>. Imidlertid er det lett √• omg√• problemet i ettertid:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lag ny versjon av h√•rfarge. Hvis h√•rfarge er tom (""), bli missing. Ellers, </span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># bli det du allerede er. </span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>stjernekrig <span class="ot">&lt;-</span> stjernekrig <span class="sc">%&gt;%</span> </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">hair_color =</span> <span class="fu">if_else</span>(</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>      hair_color <span class="sc">==</span> <span class="st">""</span>, </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>      <span class="cn">NA_character_</span>, </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>      hair_color)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>stjernekrig <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 √ó 4
  name           height  mass hair_color 
  &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      
1 Luke Skywalker    172    77 blond      
2 C-3PO             167    75 &lt;NA&gt;       
3 R2-D2              96    32 &lt;NA&gt;       
4 Darth Vader       202   136 none       
5 Leia Organa       150    49 brown      
6 Owen Lars         178   120 brown, grey</code></pre>
</div>
</div>
<p>Hvorfor <code>NA_character_</code> og ikke bare <code>NA</code>? <code>if_else</code> forventer at alle argumentene skal v√¶re av samme type/klasse. Derfor m√• til og med NA v√¶re en spesiell type NA. Siden <em>hair_color</em> er en strengvektor, m√• NA v√¶re en streng-NA.</p>
<p>N√•r vi laster inn SPSS-filer vil vi ofte f√• med merkelappene (<em>labels</em>) derfra ogs√•, i form av attributter. <code>tidyverse</code>-pakker talker ofte dette og viser dem n√•r vi printer objektene. Noen ganger har jeg opplevd, med andre pakker, at attributtene ikke kan leses. I s√• fall kan man bare fjerne dem.</p>
</section>
<section id="excel" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="excel"><span class="header-section-number">5.4</span> Excel</h2>
<p>Jeg er un√∏dvendig streng mot Excel fordi jeg gjerne vil ha ut en enkel datastruktur fra Excels filer, mens Excel tillater oss kompliserte strukturer som ikke uten videre kan puttes inn en en vanlig tabell. Som sagt er vi her avhengig av den enkelte person som lagde Excelfila n√•r det kommer til hvor lett det er for oss √• laste den inn. Det √• v√¶re konsekvent er viktigere enn √• etterlikne en ‚Äúvanlig tabell‚Äù. Til dette arbeidet har vi to pakker som har ulike bruksomr√•der:</p>
<ul>
<li><code>openxlsx</code>: <a href="https://ycphs.github.io/openxlsx/">Kilde</a>. Brukes for √• skrive Excel-filer.</li>
<li><code>readxl</code>: <a href="https://readxl.tidyverse.org/">Kilde</a>. Brukes for √• lese Excel-filer.</li>
</ul>
<section id="skrive-til-excel-openxlsx" class="level3" data-number="5.4.1">
<h3 data-number="5.4.1" class="anchored" data-anchor-id="skrive-til-excel-openxlsx"><span class="header-section-number">5.4.1</span> Skrive til Excel: <code>openxlsx</code></h3>
<p>Pakkas egen <a href="https://ycphs.github.io/openxlsx/articles/Introduction.html">introduksjon</a> er en god guide til hvordan dette funker. Sjekk den ut. I korte drag:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Kjapp lagring av fil</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> <span class="fu">write.xlsx</span>()</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Hvis du vil ha det som en tabell </span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> <span class="fu">write.xlsx</span>(<span class="at">asTable =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Her ser vi for√∏vrig en demonstrasjon av hvordan et argument er valgfritt fordi det er definert en default-verdi. I definisjonen av <code>write.xlsx()</code> st√•r det at argumentet <code>asTable</code> er satt til <code>FALSE</code>. Dermed trenger vi ikke spesifisere dette med mindre vi vil endre den til noe annet, slik vi gj√∏r i siste linje.</p>
<p>Man kan ogs√• bygge opp en excelfil mer gradvis</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Start med √• lage et workbook-objekt</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>wb <span class="ot">&lt;-</span> <span class="fu">createWorkbook</span>()</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Legg til (tomme) arkfaner</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="fu">addWorksheet</span>(wb, <span class="at">sheetName =</span> <span class="st">"Motor Trend Car Road Tests"</span>, <span class="at">gridLines =</span> <span class="cn">FALSE</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="fu">addWorksheet</span>(wb, <span class="at">sheetName =</span> <span class="st">"Iris"</span>, <span class="at">gridLines =</span> <span class="cn">FALSE</span>)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Skriv data til disse arkfanene. `mtcars` og `iris` er datasett som ligger i R.</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="fu">writeDataTable</span>(wb, <span class="at">sheet =</span> <span class="dv">1</span>, <span class="at">x =</span> mtcars, <span class="at">colNames =</span> <span class="cn">TRUE</span>, <span class="at">rowNames =</span> <span class="cn">TRUE</span>, <span class="at">tableStyle =</span> <span class="st">"TableStyleLight9"</span>)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="fu">writeDataTable</span>(wb, <span class="at">sheet =</span> <span class="dv">2</span>, iris, <span class="at">startCol =</span> <span class="st">"K"</span>, <span class="at">startRow =</span> <span class="dv">2</span>)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Lagre fila som excel-fil.</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="fu">saveWorkbook</span>(wb, <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"basics.xlsx"</span>), <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Dette lar deg spesifisere flere av de grafiske elementa i excel-fila, blant annet.</p>
<p>En apropos, dersom du har mestra pipa (<code>%&gt;%</code>): Man kan ikke uten videre pipe sammen de forskjellige kommandoene i denne pakka slik man kan med datasett. Dette gir feil:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Start med √• lage et workbook-objekt</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>wb <span class="ot">&lt;-</span> <span class="fu">createWorkbook</span>()</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Legg til (tomme) arkfaner</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fu">addWorksheet</span>(wb, <span class="at">sheetName =</span> <span class="st">"Motor Trend Car Road Tests"</span>, <span class="at">gridLines =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addWorksheet</span>(<span class="at">sheetName =</span> <span class="st">"Iris"</span>, <span class="at">gridLines =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: wb must be a Workbok</code></pre>
</div>
</div>
<p>Her ser vi alts√• en begrensing ved <code>tidyverse</code>: N√•r du bruker pakker som ikke er en del av universet deres kan vi m√•tte gj√∏re endringer i arbeidsflyten v√•r.</p>
</section>
<section id="lese-excel-filer-readxl" class="level3" data-number="5.4.2">
<h3 data-number="5.4.2" class="anchored" data-anchor-id="lese-excel-filer-readxl"><span class="header-section-number">5.4.2</span> Lese Excel-filer: <code>readxl</code></h3>
<p>Denne pakka er en del av <code>tidyverse</code>, s√• her er det bare √• stappe pipa.</p>
<p>La oss ta et steg tilbake og tenke p√• vi m√• gj√∏re n√•r vi leser inn Excel-filer. Det er en del konsepter i Excel som ikke finnes eller brukes i R:</p>
<ul>
<li>tomme rader og kolonner som rammer: Det vi ser som en tom celle i Excel er ikke n√∏dvendigvis at den eksisterer. La oss ikke bli for filosofisk her. Pakkas tekst om <a href="https://readxl.tidyverse.org/articles/sheet-geometry.html">regnearkgeometri</a> forklarer dette bedre enn jeg kan.</li>
<li>farger som indikerer et eller annet om en rad, kolonne eller celle: Dette pleier jeg se bort fra. Viktig informasjon om rader kan heller lagres i tekstformat, i f.eks. en <code>.Rmd</code>/<code>.qmd</code>-fil.</li>
<li>funksjoner: i R definerer vi funksjonene og kj√∏rer dem en gang. Funksjonene blir liggende som objekter i milj√∏et/skriptet, mens verdiene de produserer blir putta i datasettet. I Excel blir funksjonen og resultatet liggende i samme celle, opp√• hverandre. N√•r vi laster inn fila er vi bare interessert i sj√∏lve resultatene av funksjonen heller enn funksjonen i seg sj√∏l.</li>
<li>sammensl√•tte celler: Disse er spesielt vanskelig. Ifg. denne posten p√• <a href="https://stackoverflow.com/questions/37509886/how-to-read-merged-excel-cells-with-r">StackOverflow</a> kan man bruke <code>openxlsx</code> for √• lese slike filer. Hvis det gjelder noen f√• celler, f.eks. i overskrifter, ville jeg vurdert √• heller manuelt g√• inn og dele dem opp igjen.</li>
</ul>
<p>Vi kan bruke <code>read_excel()</code> fra <code>readxl</code> til √• lese inn Excel-filer. Den lar oss definere en hel del nyttige ting. Her har jeg limt inn funksjonen med alle argumentene, s√• forkalrer jeg i en kommentar hva de gj√∏r</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">read_excel</span>(</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  path, <span class="co"># Filsti + navn p√• fila du skal lese</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">sheet =</span> <span class="cn">NULL</span>, <span class="co"># Hvilke(t) regneark. Enten navn eller indeks</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">range =</span> <span class="cn">NULL</span>, <span class="co"># Celler du vil lese. I Excels format, f.eks. "B3:D87"</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_names =</span> <span class="cn">TRUE</span>, <span class="co"># Er f√∏rste linje kolonnenavn?</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_types =</span> <span class="cn">NULL</span>, <span class="co"># Definer hvilke klasser/typer hver kolonne skal lagres som</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">na =</span> <span class="st">""</span>, <span class="co"># Hvis NA er lagra som noe annet enn en tom celle, skriv det her</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">trim_ws =</span> <span class="cn">TRUE</span>, <span class="co"># Automatisk fjerning av whitespace</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">skip =</span> <span class="dv">0</span>, </span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_max =</span> <span class="cn">Inf</span>,</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">guess_max =</span> <span class="fu">min</span>(<span class="dv">1000</span>, n_max), <span class="co"># Se ned</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">progress =</span> <span class="fu">readxl_progress</span>(),</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">.name_repair =</span> <span class="st">"unique"</span> </span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Om <code>guess_max</code>: Hvis du ikke definerer <code>col_types</code> vil funksjonen gjette p√• hvilken type data hver kolonne inneholder. P√• generelt plan er Excel god p√• dette. Den sliter hvis:</p>
<ol type="1">
<li>ei kolonne inneholder flere enn en type og</li>
<li>det er mange tomme celler i starten av ei kolonne</li>
</ol>
<p>Det st√•r mer om gjettinga i <a href="https://readxl.tidyverse.org/articles/cell-and-column-types.html">Cell and Column Types</a>. Ang√•ende punkt 2: dette var et problem i barnehagekapasitetsarbeidet. Her lasta jeg inn noen omr√•der i ei Excel-fil som hadde mange tomme rader f√∏r det dukka opp en verdi. I disse tilfellene kunne jeg f√• feilmelding fordi funksjonen forventa en annen type verdi enn det den fant. L√∏sninga blei √• spesifisere kolonnetypen med <code>col_types</code>.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./grunnleggende.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Det grunnleggende</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./inspisere.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Inspisere data</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>